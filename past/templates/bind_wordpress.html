{% extends "layout.html" %}

{% import "blocks.html" as blocks %}

{% block content_block %}
    <div id="sidebar"></div>
    <div id="rightbar">
        {{blocks.rightbar_intros_block(intros)}}
        <div class="sep10"></div>
        {{blocks.rightbar_feedback_block()}}
    </div>

    <div id="middlebar">
        <!--提醒-->
        {{ blocks.notification_block() }}

        <!--绑定wordpress-->
        <div class="box">
            <div class="inner"><a href="/i">首页</a> &gt; 绑定wordpress</div>
        </div>

        <div class="sep10"></div>

    {%if wordpress_alias_list%}
        <div class="box">
            <div class="cell"><strong>已绑定的rss列表:</strong></div>
            <div class="inner">
            <ol>
                {%for x in wordpress_alias_list%}
                <li>{{x.alias}}</li>
                {%endfor%}
            </ol>
            </div>
        </div>
        <div class="sep10"></div>
    {%endif%}

    {% if step == '1'%}
        <div class="box">
            <div class="cell"><strong>再绑定一个rss地址</strong></div>
            <div id="feed1" class="inner"><table>
                <tr height="40px">
                    <td width="200px" align="right"><span class="fade">你的wordpress feed地址：</span></td>
                    <td width="280px" align="left">
                        <input type="text" class="sl" name="wordpress_feed" value=""></input>
                        <div class="sep3"></div>
                        <span class="tip smaller">比如: http://xxblog.com/feed/, 填写后不可更改</span> 
                    </td>
                </tr>
                <tr height="30px"><td align="right"><span class="fade"></span></td>
                    <td> <input type="submit" name="bind_wordpress" value="确定绑定"></input> </td>
                </tr>
            </table></div>
        </div>
    {%else%}
        <div class="box">
            <div class="cell"><strong>再绑定一个rss地址</strong> &gt; 等待验证...</div>
            <div id="feed2" class="inner">
                你的blog feed地址为：<span id="feed2_1" class="fade">{{feed_uri}}</span>
                <div class="sep10"></div>
                你的blog认领验证码为：<span id="feed2_0" class="fade">{{random_id}}</span>
                <div class="sep10"></div>
                为了验证blog的主人^^，请发一篇blog，内容为 {{random_id}}，完成该步骤后，请点下一步完成绑定
                <div class="sep3"></div>

                <input type="submit" name="confirm_bind_wordpress" value="下一步"></input>
            </div>
        </div>
    {%endif%}
        
        <div class="sep10"></div>
        <div class="box">
            <div class="inner">
                1. 理论来说，支持导入所有的rss feed，而不仅仅是wordpress
                <div class="sep3"></div>
                2. 对于wordpress rss feed来讲，只能导入最近的15篇文章，如果需要导入更多，需要去wordpress的控制面板中设置rss输出的文章数目。
                <div class="sep3"></div>
            </div>
        </div>

    <script language="javascript">
        jQuery(function($) {
            $("input[name='bind_wordpress']").bind("click", function(){
                var feed_uri = $("input[name='wordpress_feed']").val();
                $.post("/bind/wordpress", {'_r':Math.random(), 'feed_uri':feed_uri}, function(data){
                    if(data.ok === 'true'){
                        window.location="/bind/wordpress";
                    }else{
                        alert(data.msg);
                    }
                }, "json");
                return false;
            });

            var c = $("input[name='confirm_bind_wordpress']");
            c.bind("click", function(){
                c.val("正在验证中... 可能需要1分钟，请不要刷新页面");
                $.post("/bind/wordpress", {'_r':Math.random()}, function(data){
                    c.val("下一步");
                    if(data.ok === 'true'){
                        alert(data.msg);
                        window.location = "/bind/wordpress";
                    }else{
                        alert(data.msg);
                    }
                }, 'json');
            });

        });
    </script>

{% endblock %}
